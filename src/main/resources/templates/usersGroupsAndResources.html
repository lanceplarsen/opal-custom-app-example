<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Users & Resources</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

<div class="container mt-5">

    <!-- Add New User -->
    <div class="my-4">
        <h3>Add New User</h3>
        <div class="form-group">
            <label for="userEmail">Email:</label>
            <input type="email" class="form-control" id="userEmail" required>
        </div>
        <button type="button" class="btn btn-primary" onclick="submitUser()">Add User</button>
    </div>

    <!-- Add New Group -->
    <div class="my-4">
        <h3>Add New Group</h3>
        <div class="form-group">
            <label for="groupName">Name:</label>
            <input type="text" class="form-control" id="groupName" required>
        </div>
        <div class="form-group">
            <label for="groupDescription">Description:</label>
            <textarea class="form-control" id="groupDescription" rows="3"></textarea>
        </div>
        <button type="button" class="btn btn-primary" onclick="submitGroup()">Add Group</button>
    </div>   

    <!-- Add New Resource -->
    <div class="my-4">
        <h3>Add New Resource</h3>
        <div class="form-group">
            <label for="resourceName">Name:</label>
            <input type="text" class="form-control" id="resourceName" required>
        </div>
        <div class="form-group">
            <label for="resourceDescription">Description:</label>
            <textarea class="form-control" id="resourceDescription" rows="3"></textarea>
        </div>
        <button type="button" class="btn btn-primary" onclick="submitResource()">Add Resource</button>
    </div>
 
    <!-- Groups and their Users & Resources -->
    <div class="mb-4">
        <h2>Groups</h2>
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Group ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Associated Users</th>
                    <th>Associated Resources</th>  <!-- New header for Resources -->
                </tr>
            </thead>
            <tbody>
                <tr th:each="group : ${groups}">
                    <td th:text="${group.id}"></td>
                    <td th:text="${group.name}"></td>
                    <td th:text="${group.description}"></td>
                    <td>
                        <ul class="list-unstyled">
                            <li th:each="user : ${group.users}" th:text="${user.email}"></li>
                        </ul>
                    </td>
                    <td>  <!-- New column for the resources of each group -->
                        <ul class="list-unstyled">
                            <li th:each="resource : ${group.resources}" th:text="${resource.name}"></li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Users and their Resources -->
    <div class="mb-4">
        <h2>Users and their Resources</h2>
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>User ID</th>
                    <th>Email</th>
                    <th>Associated Resources</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="user : ${users}">
                    <td th:text="${user.id}"></td>
                    <td th:text="${user.email}"></td>
                    <td>
                        <ul class="list-unstyled">
                            <li th:each="resource : ${user.resources}" th:text="${resource.name}"></li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Resources and their Users -->
    <div>
        <h2>Resources and their Users</h2>
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Resource ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Associated Users</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="resource : ${resources}">
                    <td th:text="${resource.id}"></td>
                    <td th:text="${resource.name}"></td>
                    <td th:text="${resource.description}"></td>
                    <td>
                        <ul class="list-unstyled">
                            <li th:each="user : ${resource.users}" th:text="${user.email}"></li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

<script>
    function submitUser() {
        const userEmail = document.getElementById("userEmail").value;
        
        $.ajax({
            type: "POST",
            url: "/users",
            data: {
                email: userEmail
            },
            success: function() {
                // handle success scenario
                alert('User added successfully!');
                window.location.reload();
            },
            error: function() {
                // handle error scenario
                alert('Failed to add user.');
            }
        });
    }

    function submitGroup() {
        const groupName = document.getElementById("groupName").value;
        const groupDescription = document.getElementById("groupDescription").value;

        $.ajax({
            type: "POST",
            url: "/groups",
            data: {
                name: groupName,
                description: groupDescription
            },
            success: function() {
                alert('Group added successfully!');
                window.location.reload();
            },
            error: function() {
                alert('Failed to add group.');
            }
        });
    }

    function submitResource() {
        const resourceName = document.getElementById("resourceName").value;
        const resourceDescription = document.getElementById("resourceDescription").value;

        $.ajax({
            type: "POST",
            url: "/resources",
            data: {
                name: resourceName,
                description: resourceDescription
            },
            success: function() {
                alert('Resource added successfully!');
                window.location.reload();
            },
            error: function() {
                alert('Failed to add resource.');
            }
        });
    }
</script>

</body>
</html>